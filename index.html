<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Meu Compromisso</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body class="bg-page text-page">
    <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm border-bottom">
        <div class="container">
            <a class="navbar-brand fw-semibold" href="#">Meu Compromisso</a>
        </div>
    </nav>

    <main class="container my-5">
        <div class="row g-4">
            <div class="col-lg-5">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Cadastro</h5>
                        <form id="person-form">
                            <div class="mb-3">
                                <label for="nome" class="form-label">Nome completo</label>
                                <input id="nome" name="nome" class="form-control" type="text"
                                    placeholder="Nome Completo">
                            </div>

                            <div class="mb-3">
                                <label for="cpf" class="form-label">CPF</label>
                                <input id="cpf" name="cpf" class="form-control" type="text"
                                    placeholder="000.000.000-00">
                            </div>

                            <div class="mb-3">
                                <label for="data_nasc" class="form-label">Data de nascimento</label>
                                <input id="data_nasc" name="data_nasc" class="form-control" type="date">
                            </div>

                            <div class="mb-3">
                                <label class="form-label d-block">Gênero</label>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="genero" id="masc"
                                        value="masculino" checked>
                                    <label class="form-check-label" for="masc">Masculino</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="genero" id="fem"
                                        value="feminino">
                                    <label class="form-check-label" for="fem">Feminino</label>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="telefone" class="form-label">Telefone</label>
                                <input id="telefone" name="telefone" class="form-control" type="tel"
                                    placeholder="(00) 00000-0000">
                            </div>

                            <div class="mb-3">
                                <label for="cep" class="form-label">CEP</label>
                                <input id="cep" name="cep" class="form-control" type="text" placeholder="00000-000">
                            </div>

                            <div class="d-flex justify-content-between align-items-center">
                                <button type="button" class="btn btn-dark" id="save-btn">Salvar</button>
                                <small class="text-muted">Dados locais e na API</small>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="col-lg-7">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Pessoas cadastradas</h5>
                        <div class="table-responsive">
                            <table class="table table-hover table-borderless align-middle text-page">
                                <thead class="table-light">
                                    <tr onclick="tr">
                                        <th>Nome</th>
                                        <th>CPF</th>
                                        <th>Data Nasc.</th>
                                        <th>Gênero</th>
                                        <th>Telefone</th>
                                        <th>CEP</th>
                                        <th>Ações</th>

                                    </tr>
                                </thead>
                                <tbody id="table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-white border-top py-3 mt-5">
        <div class="container text-center text-muted small">© 2025 Meu Compromisso</div>
    </footer>

    <!-- Bootstrap JS bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        async function selectData() {
            try {
                const response = await fetch('http://localhost:3000/pessoas');
                const data = await response.json();

                const tableBody = document.getElementById('table-body');
                tableBody.innerHTML = '';

                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.onclick = () => preencherFormulario(row);
                    tr.innerHTML = `
                        <td>${row.nome_completo || ''}</td>
                        <td>${row.documento || ''}</td>
                        <td>${row.data_nascimeanto || row.data_nasc || ''}</td>
                        <td>${row.genero || ''}</td>
                        <td>${row.telefone || ''}</td>
                        <td>${row.cep || ''}</td>
                         <td>
            <button class="btn btn-danger btn-sm" onclick="deletePessoa('${row.documento}')">
                Excluir
            </button>
        </td>
                    `;
                    tableBody.appendChild(tr);
                });
            } catch (err) {
                console.error('Erro ao buscar dados:', err);
            }
        }


        async function saveData() {
            const payload = {
                nome_completo: document.getElementById('nome').value,
                documento: document.getElementById('cpf').value,
                data_nascimeanto: document.getElementById('data_nasc').value,
                genero: document.querySelector('input[name="genero"]:checked')?.value || '',
                telefone: document.getElementById('telefone').value,
                cep: document.getElementById('cep').value
            };

            try {
                await fetch('http://localhost:3000/pessoas', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                // Atualiza a tabela
                selectData();
                // limpa o formulário
                document.getElementById('person-form').reset();
            } catch (err) {
                console.error('Erro ao salvar:', err);
            }
        }

        async function deletePessoa(cpf) {
            if (!confirm('Tem certeza que deseja excluir esta pessoa?')) {
                return;
            }
            try {
                await fetch(`http://localhost:3000/pessoas/${cpf}`, {
                    method: 'DELETE'
                });
                // Atualiza a tabela
                selectData();
            } catch (err) {
                console.error('Erro ao excluir:', err);
            }
        }

        function preencherFormulario(row) {
            document.getElementById('nome').value = row.nome_completo || '';
            document.getElementById('cpf').value = row.documento || '';
            document.getElementById('data_nasc').value = row.data_nascimeanto || row.data_nasc || '';
            document.querySelector(`input[name="genero"][value="${row.genero}"]`)?.click();
            document.getElementById('telefone').value = row.telefone || '';
            document.getElementById('cep').value = row.cep || '';
        }

        document.getElementById('save-btn').addEventListener('click', saveData);
        // carrega dados ao abrir a página
        selectData();


    </script>
</body>
</html>